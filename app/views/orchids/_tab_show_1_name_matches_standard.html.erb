<% pi_count = 0 %>
<%= form_for(@orchid, as: 'orchid', role: 'form', remote: true) do |f| %>
  <% @orchid.names_simple_name_matching_taxon.each_with_index do |name, index| %>
    <%  if index > 0 %><br><% end %>
    <% disable_radio_button = !name.has_primary_instance? %>
        <% pi_count += 1 unless disable_radio_button %>
        <br>
        <%= f.radio_button(:name_id, name.id, disabled: disable_radio_button) %>
        <%= label_tag(:"orchid_name_id_#{name.id}", "#{name.full_name} #{name.name_status.name_for_instance_display}") %>
        <% unless name.orchid_ids.empty? || (name.id == @orchid.name_id && name.orchid_ids.size == 1) %>
        <br>
         Already the preferred match for:
         <ul>
           <b>
           <% name.orchid_ids.each do |orchid| %>
             <li><%= link_to(orchid.taxon,search_path(query_target: "orchids", query_string: "id:#{orchid.id}"),
                             title: "See #{orchid.taxon}",
                             class: 'underline') %>
           <% end %>
           </b>
         </ul>
         <br>
        <% end %>
         | <%= link_to('query name', search_path(query_string: "id: #{name.id} show-instances:",query_target: 'names'),
                          tabindex: increment_tab_index,
                          title: "Search for #{name.full_name}",
                          class: '') %>
        <% name.primary_instances.each do |p_i| %>
          <br>
          <span class="brown"><%= p_i.instance_type.name %></span>&nbsp;<%= p_i.reference.citation %>:&nbsp;<%= p_i.page %>
        <% end %>
 <% end %>
  <br>
 <% if pi_count > 0 %>
  <br>
  <%= f.submit "Save", id: 'save-orchid', tabindex: increment_tab_index, title: 'Save changes', class: 'btn btn-primary width-5em', disabled: false %>
<% else %>
  <% if name_match_count > 0 %>
    [No primary instance.]
  <% end %>
 <% end %>
<% end %>

